(("undefined"!=typeof self?self:this).webpackJsonp_pro_gallery_santa_wrapper=("undefined"!=typeof self?self:this).webpackJsonp_pro_gallery_santa_wrapper||[]).push([[4],{128:function(e,t,r){var n=function(e){"use strict";var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof h?t:h,i=Object.create(o.prototype),a=new L(n||[]);return i._invoke=function(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return R()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===u)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=l(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,a),i}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var u={};function h(){}function p(){}function f(){}var d={};d[o]=function(){return this};var v=Object.getPrototypeOf,g=v&&v(v(x([])));g&&g!==t&&r.call(g,o)&&(d=g);var y=f.prototype=h.prototype=Object.create(d);function m(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var n;this._invoke=function(o,i){function a(){return new t((function(n,a){!function n(o,i,a,s){var c=l(e[o],e,i);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==typeof h&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(h).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function w(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var n=l(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,u;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function x(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:R}}function R(){return{value:void 0,done:!0}}return p.prototype=y.constructor=f,f.constructor=p,p.displayName=s(f,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},m(b.prototype),b.prototype[i]=function(){return this},e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},m(y),s(y,a,"Generator"),y[o]=function(){return this},y.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=x,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:x(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=n}catch(e){Function("r","regeneratorRuntime = r")(n)}},14:function(e,t,r){e.exports=r(128)},26:function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return f}));var n=r(14),o=r.n(n),i=r(21),a=r(4);function s(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function c(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){s(i,n,o,a,c,"next",e)}function c(e){s(i,n,o,a,c,"throw",e)}a(void 0)}))}}var l="love",u="love",h="loveCountFromStats",p=function(){function e(){this.getEncodedContextToken=this.getEncodedContextToken.bind(this),this.parseReactionServiceResponse=this.parseReactionServiceResponse.bind(this)}var t=e.prototype;return t.getItemsLoveData=function(){var e=c(o.a.mark((function e(t,r,n,i,s){var c,l,u,h,p,f,d,v;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=this.getEncodedContextToken(i,s),l=t.map((function(e){return e.itemId})),u=l.join("&resourceIds="),h=n+"/_api/reactions-server/v1/reactions?contextToken="+c+"&resourceIds="+u,e.prev=4,e.next=7,fetch(h,{method:"GET",headers:{"Content-Type":"application/json",Authorization:r}});case 7:if(200!==(p=e.sent).status){e.next=17;break}return e.next=11,p.json();case 11:return f=e.sent,d=f.responses,v=this.parseReactionServiceResponse(d),e.abrupt("return",v);case 17:return a.a.isVerbose()&&console.error("Reaction-Service error - GET call response status: "+p.status),e.abrupt("return",{error:"Reaction-Service error - GET call response status: "+p.status});case 19:e.next=25;break;case 21:return e.prev=21,e.t0=e.catch(4),a.a.isVerbose()&&console.error("Reaction-Service error - some error when requesting data from reaction-service: "+e.t0.message),e.abrupt("return",{error:"Reaction-Service error - some error when requesting data from reaction-service: "+e.t0.message});case 25:case"end":return e.stop()}}),e,this,[[4,21]])})));return function(t,r,n,o,i){return e.apply(this,arguments)}}(),t.toggleItemLove=function(){var e=c(o.a.mark((function e(t,r,n,i,s,c){var l,h,p,f;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=this.getEncodedContextToken(s,c),h=i+"/_api/reactions-server/v1/reactions/"+t+"/"+u+"?contextToken="+l,e.prev=3,e.next=6,fetch(h,{method:r,headers:{"Content-Type":"application/json",Authorization:n}});case 6:if(200!==(p=e.sent).status){e.next=12;break}return e.next=10,p.json();case 10:f=e.sent,a.a.isVerbose()&&console.log("Succeeded "+r+" action of Reactions service for item "+t+". response: "+f);case 12:e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(3),a.a.isVerbose()&&console.error("Failed "+r+" action of Reactions service for item "+t+". "+e.t0),e.abrupt("return",{responses:"some error when requesting from reactions service"+h+e.t0.message});case 18:case"end":return e.stop()}}),e,this,[[3,14]])})));return function(t,r,n,o,i,a){return e.apply(this,arguments)}}(),t.mergeDataFromStatsToReactionService=function(){var e=c(o.a.mark((function e(t,r,n,i,s,c){var l,u,p,f,d,v;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=this.getEncodedContextToken(s,c),u=i+"/_api/reactions-server/v1/reactions/"+t+"/add-reaction?contextToken="+l,e.prev=2,e.next=5,fetch(u,{method:"POST",headers:{"Content-Type":"application/json",Authorization:n},body:JSON.stringify({reaction:{reactionCode:h,reactionParams:{count:String(r)}}})});case 5:if(200!==(p=e.sent).status){e.next=14;break}return e.next=9,p.json();case 9:return f=e.sent,a.a.isVerbose()&&console.log("Succeeded to POST old love counts from stats to Reactions service for item "+t+". response: "+f),e.abrupt("return",{status:p.status,message:"success"});case 14:return e.next=16,p.json();case 16:return d=e.sent,v=d.message,e.abrupt("return",{status:p.status,message:v});case 19:e.next=25;break;case 21:return e.prev=21,e.t0=e.catch(2),a.a.isVerbose()&&console.error("Failed to POST old love counts from stats to Reactions service for item "+t+". "+e.t0),e.abrupt("return",{responses:"some error when requesting from reactions service"+u+e.t0.message});case 25:case"end":return e.stop()}}),e,this,[[2,21]])})));return function(t,r,n,o,i,a){return e.apply(this,arguments)}}(),t.isLovedByCurrentVisitor=function(e,t,r){try{if(r){var n,o,i=null==(n=r[e])||null==(o=n.identityReactions)?void 0:o.reactions;return(null==i?void 0:i.findIndex((function(e){return e.identity.identityId===t&&e.reaction.reactionCode===u})))>-1}}catch(e){console.warn("isLovedByCurrentVisitor failed",e)}},t.parseReactionServiceResponse=function(e){try{var t=function(){for(var t={},r=function(){var e,r=o[n],i=r[0],a=r[1];t[i]=0;var s=null==(e=a.identityReactions)?void 0:e.reactions,c=!1;s.forEach((function(e){var r;switch(null==(r=e.reaction)?void 0:r.reactionCode){case h:var n,o;if(!c)t[i]+=Number(null==(n=e.reaction)||null==(o=n.reactionParams)?void 0:o.count),c=!0;break;case u:t[i]+=1}}))},n=0,o=Object.entries(e);n<o.length;n++)r();return{v:t}}();if("object"==typeof t)return t.v}catch(e){return a.a.isVerbose()&&console.error("Reaction-Service error - problem with parsing response: "+e.message),{error:"Reaction-Service error - problem with parsing response: "+e.message}}},t.shouldUseReactionService=function(){return i.b.getExperimentBoolean("specs.pro-gallery.useReactionService")},t.getEncodedContextToken=function(e,t){var r={authorizerAppDefId:t,contextId:e,contextType:l};return encodeURIComponent(JSON.stringify(r))},t.sampleMigrationSuccessRate=function(e,t,r){var n;try{if(Object.keys(e).length>0&&Object.keys(t).length>0){var o=Object.keys(e).length,i=(n=o,Math.floor(Math.random()*Math.floor(n))),a=Object.keys(e)[i],s=e[a],c=t.hasOwnProperty(a)&&t[a]||null;t.hasOwnProperty(a)?s<=c+2&&s>=c-2?"function"==typeof r&&r("Reaction-Service Migration 3rd try - Sample is successful"):"function"==typeof r&&r("Reaction-Service Migration 3rd try - Sample is failure"):"function"==typeof r&&r("Reaction-Service Migration 3rd try - Item doesnt exist in stats response")}else"function"==typeof r&&r("Reaction-Service Migration 3rd try - reactionService and stats responses are empty")}catch(e){"function"==typeof r&&r("Reaction-Service Migration 3rd try - Error in sampleMigrationSuccessRate")}},e}(),f=new p},64:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return d})),r.d(t,"itemActions",(function(){return v}));var n=r(14),o=r.n(n),i=r(5),a=r.n(i),s=r(4),c=r(9),l=r(45),u=r(2),h=r(26);function p(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function f(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){p(i,n,o,a,s,"next",e)}function s(e){p(i,n,o,a,s,"throw",e)}a(void 0)}))}}var d=function(){function e(){this.getLoveCount=this.getLoveCount.bind(this),this.wasInit=!1,this.loveCounts={},this.fetchSiteInfo()}var t=e.prototype;return t.initWidgetData=function(e){if(this.config=e,e.instance&&(this.instance=e.instance),e.items&&(this.items=e.items),e.visitorId&&(this.visitorId=e.visitorId),e.appDefinitionId&&(this.appDefinitionId=e.appDefinitionId),e.sentryReport&&(this.sentryReport=e.sentryReport),e.reportMigratedLoveDataBiEvent&&(this.reportMigratedLoveDataBiEvent=e.reportMigratedLoveDataBiEvent),e.compId&&(this.compId=e.compId),e.pageId&&(this.pageId=e.pageId),e.styleId&&(this.styleId=e.styleId),e.pageUrl&&(this.pageUrl=e.pageUrl),"boolean"==typeof e.isStoreGallery&&(this.isStoreGallery=e.isStoreGallery),"boolean"==typeof e.shouldUseGalleryIdForShareUrl&&(this.shouldUseGalleryIdForShareUrl=e.shouldUseGalleryIdForShareUrl),e.galleryId&&(this.galleryId=e.galleryId),e.viewMode&&(this.viewMode=e.viewMode.toLowerCase()),e.fullscreenUrl){this.siteUrl=this.fullscreenUrl=this.normalizeFullscreenUrl(e.fullscreenUrl);try{this.siteUrl=this.fullscreenUrl.match(/.*\..*\//g)[0]}catch(e){}}return e.onLoveCountsFetched&&(this.onLoveCountsFetched=e.onLoveCountsFetched),this.baseUrl=e.baseUrl||"//progallery.wixapps.net",e.reachLevel&&this.setReachLevel(e.reachLevel),!s.a.isSSR()&&"site"===this.viewMode&&this.galleryId&&""!==this.galleryId&&this.getStats(),this.wasInit=e,Date.now()},t.setItemsLoveData=function(e){var t=e.itemsLoveData;if(t){this.reactionsServiceResponse=t;var r=h.b.parseReactionServiceResponse(t);this.onLoveCountsFetched(r)}},t.normalizeFullscreenUrl=function(e){var t=e;return e&&(t=e.split("?")[0]),t},t.fetchSiteInfo=function(){var e,t=this;try{e=u.a.location.href}catch(t){e=""}s.a.isInWix()?(this.siteInfo={},c.a.getSiteInfo((function(e){t.siteInfo=e}))):this.siteInfo={url:e,baseUrl:e,siteTitle:"Wix Pro Gallery",siteDescription:"The best gallery any Wix user has ever seen!",siteKeywords:"gallery,photos,photographer,professional"}},t.getSiteUrl=function(){return this.siteInfo.url},t.getStats=function(){var e=f(o.a.mark((function e(){var t=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("site"===this.viewMode&&!s.a.isDev()&&!s.a.isTest()){e.next=2;break}return e.abrupt("return");case 2:if(this.galleryId&&""!==this.galleryId&&!(this.galleryId.length<10)){e.next=6;break}return console.log("galleryId id",this.galleryId,typeof this.galleryId),console.error("get stats error - no galleryId"),e.abrupt("return");case 6:return fetch(this.baseUrl+"/_api/pro-gallery-webapp/v1/gallery/"+this.galleryId+"/stats/properties").then((function(e){return e.json()})).then((function(e){try{e.properties?t.statsProps=JSON.parse(e.properties):e.statsToken&&(t.statsProps={instance_id:t.config.instanceId,set_id:t.galleryId}),t.statsToken=e.statsToken}catch(e){console.error("Failed getting stats props",e)}})),e.next=9,this.migrateLoveDataFromStatsToReactionService();case 9:h.b.shouldUseReactionService()||this.getLoveDataWithOriginalFunction();case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.migrateLoveDataFromStatsToReactionService=function(){var e=f(o.a.mark((function e(){var t,r,n,i,a,c,l,u,p,f,d,v,g;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.b.getItemsLoveData(this.items,this.instance,this.baseUrl,this.galleryId,this.appDefinitionId);case 3:if(!(t=e.sent).hasOwnProperty("error")){e.next=7;break}return"function"==typeof this.sentryReport&&(r=t.error,this.sentryReport(r)),e.abrupt("return");case 7:return e.next=9,this.getLoveDataUsingStatsApi();case 9:if(n=e.sent,h.b.sampleMigrationSuccessRate(t,n,this.sentryReport),0!==Object.keys(t).length){e.next=26;break}return e.next=14,this.getLoveDataUsingStatsApi();case 14:if(i=e.sent,!(Object.keys(i).length>0)){e.next=26;break}for("function"==typeof this.reportMigratedLoveDataBiEvent&&this.reportMigratedLoveDataBiEvent({galleryId:this.galleryId,migrationStatus:"start"}),a=[],c=0,l=Object.entries(i);c<l.length;c++)u=l[c],p=u[0],f=u[1],a.push(h.b.mergeDataFromStatsToReactionService(p,f,this.instance,this.baseUrl,this.galleryId,this.appDefinitionId));return e.next=21,Promise.all(a);case 21:return d=e.sent,e.next=24,h.b.getItemsLoveData(this.items,this.instance,this.baseUrl,this.galleryId,this.appDefinitionId);case 24:t=e.sent,s.a.isSubset(i,t)?"function"==typeof this.reportMigratedLoveDataBiEvent&&this.reportMigratedLoveDataBiEvent({galleryId:this.galleryId,migrationStatus:"success"}):"function"==typeof this.sentryReport&&((v=d.findIndex((function(e){return"200"!==e.status.toString()})))>-1?(g="Reaction-Service error - migrating data failed - "+d[v].status+" : "+d[v].message,this.sentryReport(g)):("Reaction-Service error - loveCountsReactionService !== loveCountsStatsApi",this.sentryReport("Reaction-Service error - loveCountsReactionService !== loveCountsStatsApi")));case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(0),"function"==typeof this.sentryReport&&("Reaction-Service error - Migration general error",this.sentryReport("Reaction-Service error - Migration general error"));case 31:case"end":return e.stop()}}),e,this,[[0,28]])})));return function(){return e.apply(this,arguments)}}(),t.getLoveDataUsingStatsApi=function(){var e=f(o.a.mark((function e(){var t,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="",e.prev=1,t=this.config.instanceId||u.a.instanceId){e.next=8;break}return console.warn("cannot report love counter - no instance id"),e.abrupt("return");case 8:return e.next=10,fetch(this.baseUrl+"/_api/pro-gallery-webapp/v1/gallery/"+this.galleryId+"/"+t+"/stats");case 10:return r=e.sent,e.next=13,r.json();case 13:if(!(r=e.sent)||!r.photoId2Love){e.next=18;break}return e.abrupt("return",r.photoId2Love);case 18:return e.abrupt("return");case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(1),console.error("Failed getting love counts",e.t0);case 24:case"end":return e.stop()}}),e,this,[[1,21]])})));return function(){return e.apply(this,arguments)}}(),t.getLoveDataWithOriginalFunction=function(){var e,t=this;try{e=this.config.instanceId||u.a.instanceId}catch(t){e=""}e?fetch(this.baseUrl+"/_api/pro-gallery-webapp/v1/gallery/"+this.galleryId+"/"+e+"/stats").then((function(e){return e.json()})).then((function(e){try{e&&e.photoId2Love&&(t.loveCounts=e.photoId2Love,t.onLoveCountsFetched&&t.onLoveCountsFetched(t.loveCounts))}catch(e){console.error("Failed getting love counts",e)}})):console.warn("cannot report love counter - no instance id")},t.getLoveCount=function(e){return Math.max(0,this.loveCounts[e])||0},t.html2img=function(e,t){r.e(11).then(r.t.bind(null,198,7)).then((function(r){try{var n=u.a.document.createElement("div");n.innerHTML=e.html,n.style.boxSizing="border-box",n.style.background=e.style.bgColor,n.style.position="absolute",n.style.top=0,n.style.left=0,n.style.zIndex=-1,n.className="text-item",u.a.document.body.appendChild(n),r(n).then((function(e){n.remove();var r=e.toDataURL();"function"==typeof t&&t(r)}))}catch(e){"function"==typeof t&&t("")}}))},t.share=function(e,t,r){s.a.isDemo()||(r&&(t.numOfItems=r),this.shareImp(e,t))},t.downloadTextItem=function(e){this.html2img(e,(function(e){try{e=e.replace(/^data:image\/[^;]/,"data:application/octet-stream"),u.a.open(e)}catch(e){}}))},t.getReachLevel=function(e){var t,r=Number(e||0);if(a.a.isUndefined(this.reachLevel)){var n=s.a.getLocalStorage();t=Number(n[this.siteUrl+"|reach-level"]||0)+r}else t=this.reachLevel+r;return t},t.setReachLevel=function(e){e>0||(e=0);try{var t=this.getReachLevel(0);if(e>0&&0===t&&a.a.isUndefined(this.reachLevel))s.a.getLocalStorage()[this.siteUrl+"|reach-level"]=e,this.reachLevel=e}catch(e){console.warn("set reach level error",e)}},t.getShareUrl=function(e){var t=this.shouldUseGalleryIdForShareUrl?this.galleryId+"_":this.compId.replace("comp-","")+"-";return this.pageUrl+"?pgid="+t+this.getItemId(e)},t.getItemId=function(e){return e.id||e.photoId||e.itemId},t.shareImp=function(e,t,r){var n={id:this.getItemId(t),idx:t.idx||0,url:t.createUrl&&t.createUrl("sample","img"),title:t.title||t.description||this.siteInfo.siteTitle,hashtag:t.hashtag},o=encodeURIComponent(this.getShareUrl(n)),i=encodeURIComponent(n.title||""),c=encodeURIComponent(n.url),l=encodeURIComponent(this.siteInfo.siteKeywords),h=encodeURIComponent(""+this.getShareUrl(n));switch(a.a.isFunction(r)||(r=function(e,t){try{if(s.a.isiOS()&&"Email"===t)u.a.location.href=e;else{var r=u.a.open(e,t+" Share","height=640,width=960,toolbar=no,menubar=no,scrollbars=no,location=no,status=no");setTimeout((function(){try{"Email"===t&&r.location.hasOwnProperty("pathname")&&"blank"===r.location.pathname&&r.close()}catch(e){console.warn("Could not close mailto window")}}),5e3)}}catch(e){}}),e){case"facebook":r("http://www.facebook.com/sharer/sharer.php?u="+o+"&t="+i,"Facebook");break;case"twitter":var p="&amp;text="+("undefined"===i?"":i);if(p.length>110)p=p.slice(0,107)+"...";else{var f="&amp;hashtags="+l;(p+f).length<=110&&(p+=f)}r("https://twitter.com/intent/tweet?url="+o+p,"Twitter");break;case"pinterest":r("https://pinterest.com/pin/create/button/?url="+o+"&media="+c.replace("webp","jpg")+"&description="+i,"Pinterest");break;case"google":r("https://plus.google.com/share?url="+o,"Google Plus");break;case"tumblr":r("http://www.tumblr.com/share/link?url="+o,"Tumblr");break;case"email":r("mailto:?Subject="+i+"&body="+h,"Email");break;case"copylink":!function(e){var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t);var r=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);t.select(),document.execCommand("copy"),document.body.removeChild(t),r&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(r))}(this.getShareUrl(n))}},t.reportLoveToStats=function(e,t){try{if(!this.statsProps||!this.statsProps.instance_id)return void this.getStats();var r=a.a.merge(this.statsProps,{photo_id:e}),n=this.statsToken||u.a.statsToken,o=s.a.generateUUID();fetch(u.a.location.protocol+"//photographers-counters.wix.com/collector/rest/collect-js?ctToken="+n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messageId:o,metrics:[{type:"photo",reportMetrics:[{name:"love",value:String(t)}],properties:r}]})}).then((function(e){console.log("Success report love",e)}))}catch(e){console.error("Error reporting love to stats",e)}},t.getLoveStorageKey=function(e){return"pro-gallery-item-love-"+e},t.isLoved=function(e){if(h.b.shouldUseReactionService()){var t=h.b.isLovedByCurrentVisitor(e,this.visitorId,this.reactionsServiceResponse),r=s.a.getLocalStorage()[this.getLoveStorageKey(e)];return t||r}try{return void 0!==s.a.getLocalStorage()&&(!!s.a.getLocalStorage()[this.getLoveStorageKey(e)]||!1)}catch(e){console.warn("isLoved failed",e)}},t.toggleLove=function(e,t){try{var r=this.isLoved(e)?"DELETE":"PUT";h.b.toggleItemLove(e,r,this.instance,this.baseUrl,this.galleryId,this.appDefinitionId)}catch(t){if(s.a.isVerbose()&&console.warn("Reaction service toggleLove failed",t),"function"==typeof this.sentryReport){var n="Reaction Service error - couldn't toggle love data in gallery: "+this.galleryId+" item: "+e;this.sentryReport(n)}}try{if(!s.a.getLocalStorage())return!1;var o;this.isLoved(e)&&!0!==t||!1===t?(s.a.getLocalStorage()[this.getLoveStorageKey(e)]="",o=-1):(s.a.getLocalStorage()[this.getLoveStorageKey(e)]=!0,o=1),this.reportLoveToStats(e,o)}catch(e){console.warn("toggleLove failed",e)}},t.isFirstLoveClick=function(e){try{return void 0===s.a.getLocalStorage()[this.getLoveStorageKey(e)]}catch(e){console.warn("isFirstLoveClick failed",e)}},t.postLoveActivity=function(e){var t=this.getItemId(e);this.isFirstLoveClick(t)&&function(e){try{var t={type:c.a.Activities.Type.SOCIAL_TRACK,info:{type:e.activityType,channel:e.activityNetwork,itemInfo:{itemUrl:e.url,itemId:e.id,itemType:e.type.toUpperCase()}},details:{additionalInfoUrl:e.url,summary:""},contactUpdate:null};c.a.Activities.postActivity(t,(function(e){console.log("Activity ID: "+e.activityId+", Contact ID: "+e.contactId)}),(function(e){console.log("Failure message:",e)}))}catch(e){console.log("error posting activity.",e)}}({activityType:"LOVE",activityNetwork:"SITE",id:t,url:this.getShareUrl(e),type:e.type})},t.showTooltip=function(e,t,r){if(!(document.getElementsByClassName("pro-tooltip").length>=1)){var n=e.currentTarget;if(n){var o,i,a=n.getBoundingClientRect(),s=a.top,c=a.left;try{i=u.a.innerWidth}catch(e){i=980}switch(void 0===r&&(r=c>i/2?"right":"left"),r){case"top":o={top:s-30+"px",left:c+28+"px",opacity:1};break;case"right":o={top:s-4+"px",left:c-20+"px",opacity:1};break;default:case"left":o={top:s-4+"px",left:c+40+"px",opacity:1}}o["pointer-events"]="none";var h=u.a.document.createElement("div");h.classList.add("pro-tooltip"),h.classList.add(r),Object.assign(h.style,o),h.innerHTML=l.a.getByKey(t),u.a.document.body.appendChild(h)}}},t.hideTooltip=function(){u.a.document.body.removeChild(document.getElementsByClassName("pro-tooltip")[0])},t.toggleTooltip=function(e,t,r){1===document.getElementsByClassName("pro-tooltip").length?this.hideTooltip():this.showTooltip(e,t,r)},t.viewClassName=function(e,t){return"fullscreen"===e&&"desktop"===t?"fullscreen-icon":""},e}(),v=new d}}]);
//# sourceMappingURL=ItemActions.chunk.min.js.map